
{% extends "squelette_gestionFichier.html" %}
 {% block header %}
        <link rel="stylesheet" href="/static/css/jqtree.css">
  
        <link rel="stylesheet" href="/static/css/gestionFichier.css">
        <script src="/static/lib/jqTree/tree.jquery.js"></script>
{% macro remastering(list) %}{% autoescape false %}
{%- set idxs = [0] -%}
    [{%- for item in list.children recursive %}
	{%- if loop.index0 > 0 -%},{%- endif %}{name: '{{ item.name }}', fullname: '{{ item.fullname }}', id: {{ idxs|length*1000 + loop.index}}
        {%- if item.children -%}{%- set tmp = idxs.append(loop.index) -%},children: [{{ loop(item.children) }}]{%- set tmp = idxs.pop() -%}{%- endif %}
     }{%- endfor %}]
{% endautoescape %}
{%- endmacro %}
<script type="text/javascript">
$(function() {
    var $treePath = $('#treePath');
    var dataPath = {{ remastering(path_list) }};
    $treePath.tree({data: dataPath,autoOpen: 1});
    $tree.bind('tree.dblclick',function(e) {
        var selected_node = e.node;
        alert(selected_node.fullname);
    });
    var $tree = $('#treeFic');
    var dataFile = {{ remastering(file_list) }};
    $tree.tree({data: dataFile,autoOpen: true});
    $tree.bind('tree.click',function(e) {
        // Disable single selection
        e.preventDefault();
        var selected_node = e.node;
        if (selected_node.id == undefined) {console.log('The multiple selection functions require that nodes have an id');}
        if ($tree.tree('isNodeSelected', selected_node)) {$tree.tree('removeFromSelection', selected_node);}
        else {$tree.tree('addToSelection', selected_node);}
    });
     $tree.bind('tree.dblclick',function(e) {
        var selected_node = e.node;
        alert(selected_node.fullname);
    });
});
</script>
<script type="text/javascript">
function ChargementForm(Form){
var nodes = $('#treeFic').tree('getSelectedNodes');
var FilesSelected="";
for (var i=0;i < nodes.length; i++){
	FilesSelected +=  nodes[i].fullname + ';';
}
Form.FilesSelected.value = FilesSelected;
Form.PathSelected.value = $('#treePath').tree('getSelectedNode').fullname;
}
</script>
{% endblock %}

{% block listes %}
	<div class="liste">
		<h2>Liste Fichiers</h2> 
		<div id="treeFic">
		</div>
		<textarea id="FilesSelected" style="display:none;" name="FilesSelected"></textarea>
	</div>
	<div class="liste">
		<h2>Liste r√©pertoires</h2> 
		<div id="treePath">
		</div>
		<textarea id= "PathSelected" style="display:none;" name="PathSelected"></textarea>
	</div>

	
{% endblock %}

