{% extends "squelette.html" %}

{% block titre %}Osmc Salon by JGriffon{% endblock %}

{% block corps %}
<h1>Bienvenue {{ self.titre() }}</h1>
<br>
        <br>Bienvenue dans cet environnement de test <br>
<h2><a href="/majWeb/">MaJ du serveur</a></h2><br><br><br>

<button onclick="start()">Lancer MAJ</button>
<button onclick="stop()">stopper MAJ</button>
<br><br><br>
<div id="bip" class="display"></div>

<script>
var counter = 0;
var intervalId = null;
function stop()
{
  clearInterval(intervalId);
  document.getElementById("bip").innerHTML = "";	
}
function bip()
{
    document.getElementById("bip").innerHTML = counter + " secondes passées";
    counter++;
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    var content = $SCRIPT_ROOT+"/_majData";
    $.getJSON($SCRIPT_ROOT+"/_majData",
        function(data) {
            var sortie = "<hr>";
            sortie += "<h2>Processus (PID ou statut)</h2>";
            sortie += data.allprocesses.toString() + "<hr>";
            for(elt in data.processes){
                sortie += "<li>" + data.processes[elt].name + " : " + (data.processes[elt].lstPID == "" ? "OFF !!" : data.processes[elt].lstPID) + "</li>";
            };
            sortie += "<hr>";
            $("#processus").html(sortie);
            
            sortie = "<h2>Généralités</h2>";
            sortie += "<li>hostname  " + data.hostname + " ( " + data.ip + " ) </li>";
            sortie += "<li>uptime : " + data.uptime + "</li>";
            sortie += "<li>temperature : " + data.temperature + " °C</li>";
            sortie += "<li>cpufrequency : " + data.cpufrequency + "</li><hr>";
            $("#gen").html(sortie);
            
            sortie = "<h2>Processeur</h2><ul>";
            sortie += "<li>Nb cpu : " + data.numcpu + "</li>";
            sortie += "<li>cpuusage :</li><ul>";
            sortie += "<li>average : " + data.cpuusage.average + "</li>";
            sortie += "<li>values : " + data.cpuusage.values + "</li></ul>";
            sortie += "</ul><hr>";
            $("#cpu").html(sortie);
            
            sortie = "<h2>Mémoire</h2>";
            sortie += "<li>total : " + data.memory.total + "</li>";
            sortie += "<li>used : " + data.memory.used + "</li>";
            sortie += "<li>available : " + data.memory.available + "</li>";
            sortie += "<li>free : " + data.memory.free + "</li>";
            sortie += "<hr>";
            $("#mem").html(sortie);

            sortie = "<h2>Disques</h2>";
            for(elt in data.disk){
                sortie += "<li>disk device : " + data.disk[elt].device + "( mountpoint : " +  data.disk[elt].mountpoint + ", fstype : " + data.disk[elt].fstype + " )<ul>";
                sortie+= "<li>total : " + data.disk[elt].total + "</li>";
                sortie+= "<li>used  : " + data.disk[elt].used + "</li>";
                sortie+= "<li>free  : " + data.disk[elt].free + " ( " + data.disk[elt].percent + " % )</li>";
                sortie+= "</ul></li>";
            };
            sortie += "<hr>";
            $("#disk").html(sortie);

            
        }
    );
}
function start()
{
  intervalId = setInterval(bip, 1000);
}
</script>    

<div class="status" id="gen"></div>
<div class="status" id="processus"></div>
<div class="status" id="cpu"></div>
<div class="status" id="mem"></div>
<div class="status" id="disk"></div>
<br><br><br><br><hr>
{% endblock %}

<!-- content= -->
<!-- *******disk********* -->
    <!-- 'disk': [{'used': '2 Gb',  -->
            <!-- 'percent': 16,  -->
            <!-- 'free': '10 Gb',  -->
            <!-- 'fstype': 'ext4',  -->
            <!-- 'device': '/dev/mmcblk0p2',  -->
            <!-- 'mountpoint': '/',  -->
            <!-- 'total': '13 Gb'}, -->
        <!-- {'used': '332 Gb',  -->
            <!-- 'percent': 35,  -->
            <!-- 'free': '599 Gb', -->
            <!-- 'fstype': 'fuseblk',  -->
            <!-- 'device': '/dev/sda1',  -->
            <!-- 'mountpoint': '/media/Maxtor',  -->
            <!-- 'total': '931 Gb'},  -->
        <!-- {'used': '29 Mb',  -->
            <!-- 'percent': 12,  -->
            <!-- 'free': '209 Mb',  -->
            <!-- 'fstype': 'vfat',  -->
            <!-- 'device': '/dev/mmcblk0p1',  -->
            <!-- 'mountpoint': '/boot',  -->
            <!-- 'total': '239 Mb'},  -->
        <!-- {'used': '332 Gb',  -->
            <!-- 'percent': 35,  -->
            <!-- 'free': '599 Gb',  -->
            <!-- 'fstype': 'fuseblk',  -->
            <!-- 'device': '/dev/sda1',  -->
            <!-- 'mountpoint': '/mnt/LOC/USB',  -->
            <!-- 'total': '931 Gb' -->
        <!-- }],  -->
<!-- *******gen********* -->
    <!-- { -->
    <!-- 'cpufrequency': '0 Mhz', --> 
    <!-- 'ip': ['192.168.1.16'],  -->
    <!-- 'freespace': '10 Gb', -->
    <!-- 'uptime': '0d 15h 39m 36s',  -->
    <!-- 'temperature': 0,  -->
    <!-- 'hostname': 'osmc',  -->
<!-- *******cpu********* -->
    <!-- 'numcpu': 4, -->
    <!-- 'cpuusage': { -->
        <!-- 'average': 30,  -->
        <!-- 'values': [20.0, 100.0, 0.0, 0.0] -->
    <!-- },  -->
    <!-- 'loadavg': { -->
        <!-- 'la1': 0.68,  -->
        <!-- 'la2': 0.77,  -->
        <!-- 'la3': 0.74 -->
    <!-- },  -->
    <!-- 'cpu': { -->
        <!-- 'softirq': 0,  -->
        <!-- 'iowait': 1,  -->
        <!-- 'system': 0,  -->
        <!-- 'idle': 91,  -->
        <!-- 'user': 6,  -->
        <!-- 'irq': 0,  -->
        <!-- 'nice': 0 -->
    <!-- } -->
<!-- *******mem********* -->    
    <!-- 'memory': { -->
        <!-- 'available': '287 Mb',  -->
        <!-- 'used': '446 Mb',  -->
        <!-- 'bufferraw': 31608832,  -->
        <!-- 'usedraw': 468017152,  -->
        <!-- 'free': '214 Mb',  -->
        <!-- 'total': '733 Mb',  -->
        <!-- 'buffers': '30 Mb',  -->
        <!-- 'freeraw': 225222656,  -->
        <!-- 'cachedraw': 89501696,  -->
        <!-- 'cached': '85 Mb',  -->
        <!-- 'swtotal': '0 b',  -->
        <!-- 'percent': 60,  -->
        <!-- 'swpercent': 0,  -->
        <!-- 'swfree': '0 b' -->
    <!-- },  -->
    
<!-- } -->